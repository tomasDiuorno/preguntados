<body class="bg-[#1e1f3b] bg-[url('/public/bg.jpg')] bg-cover bg-center flex justify-center min-h-screen items-start h-screen py-12 px-4">
<div class="w-full  max-w-4xl bg-[#343964] rounded-2xl shadow-2xl overflow-hidden flex flex-col">
<header class="border-b border-[#2c2f56]">
    <nav aria-label="Global" class="mx-auto flex max-w-7xl items-center justify-between p-6 lg:px-8">
        <!-- Logo -->
        <div class="flex lg:flex-1">
            <a href="/menu" class="-m-1.5 p-1.5">
                <span class="sr-only">Preguntados</span>
                <img src="https://about.preguntados.com/resources/images/cards/games/TC1_Icon.svg" alt="Logo Preguntados" class="h-8 w-auto" />
            </a>
        </div>
        <!-- Botón Menú Móvil -->
        <div class="flex lg:hidden lg:pointer-events-none">
            <button type="button" data-command="show-modal" data-target="mobile-menu" class="-m-2.5 inline-flex items-center justify-center rounded-md p-2.5 text-gray-300 hover:text-white">
                <span class="sr-only">Abrir menú principal</span>
                <svg viewBox="0 0 24 24"  stroke="currentColor" stroke-width="1.5" data-slot="icon" aria-hidden="true" class="size-6">
                    <path d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" stroke-linecap="round" stroke-linejoin="round" />
                </svg>
            </button>
        </div>

        <!-- Links de Escritorio -->
        <div class="hidden lg:flex lg:gap-x-12">
            {{#sesion}}
                <!-- Links si está logueado -->
                <a href="/menu" class="text-sm/6 font-semibold text-white hover:text-[#BC6BE8] transition-colors">Menu</a>
                <a href="/historial" class="text-sm/6 font-semibold text-white hover:text-[#BC6BE8] transition-colors">Historial</a>
                <a href="/ranking" class="text-sm/6 font-semibold text-white hover:text-[#BC6BE8] transition-colors">Ranking</a>
                <!-- Mostrar Salir después de Categoria (en rojo) -->
                <a href="/login/logout" class="text-sm/6 font-semibold text-red-500 hover:text-red-400 transition-colors">Salir</a>
            {{/sesion}}
            {{^sesion}}
                <!-- Links si NO está logueado -->
            {{/sesion}}
        </div>

        <!-- Login/Logout Escritorio -->
        <div class="hidden lg:flex lg:flex-1 lg:justify-end items-center gap-4">
            {{#sesion}}
                <!-- Mostrar avatar + nombre que enlaza al perfil (a la derecha) -->
                <a href="/perfil/base/{{sesion.id}}" class="flex items-center gap-3 text-white hover:opacity-90 transition">
                    <img src="{{sesion.fotoDePerfil}}" onerror="this.src='/public/placeholder.png'" alt="Avatar" class="w-9 h-9 rounded-full object-cover border-2 border-[#BC6BE8]">
                    <span class="font-semibold">{{sesion.nombreDeUsuario}}</span>
                </a>
            {{/sesion}}
            {{^sesion}}
                <a href="/login" class="text-sm/6 font-semibold text-white hover:text-[#BC6BE8] transition-colors">Iniciar Sesión</a>
                <a href="/register" class="ml-6 text-sm/6 font-semibold text-white py-2 px-4 rounded-lg bg-gradient-to-r from-[#E65895] to-[#BC6BE8] hover:opacity-90 transition-opacity">Registrarse</a>
            {{/sesion}}
        </div>
    </nav>

    <!--
      Menú Móvil (en un <dialog>)
    -->
    <dialog id="mobile-menu" style="display:none;" class="backdrop:bg-black/50 backdrop:backdrop-blur-sm lg:hidden p-0 m-0 ml-auto h-full max-h-full max-w-full">
        <div tabindex="0" class="focus:outline-none h-full">
            <!--
              Panel del Menú Móvil
              - USA los colores de tu tema
            -->
            <div class="fixed inset-y-0 right-0 z-50 w-full overflow-y-auto bg-[#343964] p-6 sm:max-w-sm sm:ring-1 sm:ring-transparent border-l border-[#2c2f56] h-full">
                <!-- Header Menú Móvil -->
                <div class="flex items-center justify-between">
                    <a href="/" class="-m-1.5 p-1.5">
                        <span class="sr-only">Preguntados</span>
                        <img src="https://about.preguntados.com/resources/images/cards/games/TC1_Icon.svg" alt="" class="h-8 w-auto" />
                    </a>
                    <button type="button" data-command="close" data-target="mobile-menu" class="-m-2.5 rounded-md p-2.5 text-gray-300 hover:text-white">
                        <span class="sr-only">Cerrar menú</span>
                        <svg viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5" data-slot="icon" aria-hidden="true" class="size-6">
                            <path d="M6 18 18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" />
                        </svg>
                    </button>
                </div>
                <!-- Links Menú Móvil -->
                <div class="mt-6 flow-root">
                    <div class="-my-6 divide-y divide-white/10">
                        <div class="space-y-2 py-6">
                            {{#sesion}}
                                <a href="/menu" class="-mx-3 block rounded-lg px-3 py-2 text-base/7 font-semibold text-white hover:bg-[#2c2f56] transition-colors">Menu</a>
                                <a href="/historial" class="-mx-3 block rounded-lg px-3 py-2 text-base/7 font-semibold text-white hover:bg-[#2c2f56] transition-colors">Historial</a>
                                <a href="/ranking" class="-mx-3 block rounded-lg px-3 py-2 text-base/7 font-semibold text-white hover:bg-[#2c2f56] transition-colors">Ranking</a>
                                <a href="/perfil/base/{{sesion.id}}" class="-mx-3 block rounded-lg px-3 py-2 text-base/7 font-semibold text-white hover:bg-[#2c2f56] transition-colors">{{sesion.nombreDeUsuario}}</a>
                            {{/sesion}}
                        </div>
                        <div class="py-6">
                            {{#sesion}}
                                <a href="/login/logout" class="-mx-3 block rounded-lg px-3 py-2.5 text-base/7 font-semibold text-white hover:bg-[#2c2f56] transition-colors">Salir</a>
                            {{/sesion}}
                            {{^sesion}}
                                <a href="/login" class="-mx-3 block rounded-lg px-3 py-2.5 text-base/7 font-semibold text-white hover:bg-[#2c2f56] transition-colors">Iniciar Sesión</a>
                                <a href="/register" class="-mx-3 block rounded-lg px-3 py-2.5 text-base/7 font-semibold text-white hover:bg-[#2c2f56] transition-colors">Registrarse</a>
                            {{/sesion}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </dialog>
</header>


<!--
  Script para manejar el menú móvil.
  Lo incluyo aquí para que el navbar sea autocontenido.
-->
<script>
    // Asegurarse de que el script no se ejecute múltiples veces si se carga varias veces
    if (!window.navbarScriptLoaded) {
        window.navbarScriptLoaded = true;

        document.addEventListener('DOMContentLoaded', () => {
            const openButtons = document.querySelectorAll('[data-command="show-modal"]');
            const closeButtons = document.querySelectorAll('[data-command="close"]');

            openButtons.forEach(button => {
                // Evitar duplicar listeners si el DOM se recarga
                if (button.dataset.listenerAttached) return;
                button.dataset.listenerAttached = true;

                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-target');
                    const dialog = document.getElementById(targetId);
                    if (dialog) {
                        // mostrar el diálogo explícitamente para evitar que esté visible por defecto
                        dialog.style.display = 'block';
                        dialog.showModal();
                    }
                });
            });

            closeButtons.forEach(button => {
                if (button.dataset.listenerAttached) return;
                button.dataset.listenerAttached = true;

                button.addEventListener('click', () => {
                    const targetId = button.getAttribute('data-target');
                    const dialog = document.getElementById(targetId);
                    if (dialog) {
                        dialog.close();
                        // ocultar después de cerrar para evitar que quede visible
                        dialog.addEventListener('close', () => { dialog.style.display = 'none'; }, { once: true });
                    }
                });
            });

            document.querySelectorAll('dialog').forEach(dialog => {
                if (dialog.dataset.listenerAttached) return;
                dialog.dataset.listenerAttached = true;

                dialog.addEventListener('click', (event) => {
                    if (event.target === dialog) {
                        dialog.close();
                        dialog.addEventListener('close', () => { dialog.style.display = 'none'; }, { once: true });
                    }
                });
            });
        });
    }
</script>